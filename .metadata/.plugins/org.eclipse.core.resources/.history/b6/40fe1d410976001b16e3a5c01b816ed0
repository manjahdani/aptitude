/** 
 * 
 */
package be.uclouvain.aptitude.agents.algorithm

import be.uclouvain.organisation.told.LeavePlatform
import io.sarl.core.Destroy
import io.sarl.core.Initialize
import io.sarl.core.Logging
import java.io.FileReader
import org.json.simple.JSONObject

/** 
 * @author manjah
 * 
 */
behavior TrackerRole {
	uses Logging, Tracking

	var partnerTrackingName : String
	on Initialize {
		// Event trigger before the behavior begin to live or to be used.
		// You should put all the initialization statements in this block of code.
		info("The behavior was started.")
		setSkill(new TrackingImpl)
		var configPathTracker = occurrence.parameters.get(0).toString // occurrence.parameters.get(1).toString
		var jsonTracker=parser.parse(new FileReader(configPathTracker)) as JSONObject;
		requestTracker(jsonTracker)
	}

	on Destroy {
		// Event trigger when the behavior is destroyed from the system.
		// You should put all the resource releasing statements in this block of code.
		info("The behavior was stopped.")
	}

	on PartnerTrackingFound {
		this.partnerTrackingName = occurrence.partnerName
		info("Tracking Partner found: " + this.partnerTrackingName)
	}

	on LeavePlatform {
		// join(BaseContext.ID, BaseSpace.spaceID.ID)
		info("ObserverTrackerLeaving")
		//sendAction(4)
		//leave(PlatformID)
	}

	on BBoxes2DResult {
		getTrack(occurrence.bboxes2D)

		// println("***********************")
			// println("----  " + occurrence.bboxes2D.frameNumber)
				// println("*  " + Arrays.toString(occurrence.bboxes2D.bboxes))
			// println("*  " + Arrays.toString(occurrence.bboxes2D.classIDs))
		// println("*  " + Arrays.toString(occurrence.bboxes2D.detConfs))
		// println("*  " + occurrence.bboxes2D.lastFrame)
		// println("***********************")
				// if (occurrence.bboxes2D.lastFrame) {
					// info("That was it!")
		// val totalTime = (((System.currentTimeMillis() - this.start) / 1000))
		// info("It took " + totalTime.toString + " seconds")
		// info("Average FPS : " + (occurrence.bboxes2D.frameNumber / totalTime).toString)
		// }
		// if (occurrence.bboxes2D.frameNumber != this.expectedFrame) {
		// println("UNEXPECTED")
		// }
		// this.expectedFrame = occurrence.bboxes2D.frameNumber +1
	}
}
