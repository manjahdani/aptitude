/** 
 */
package be.uclouvain.organisation.platform

import io.sarl.core.Destroy
import io.sarl.core.Initialize
import io.sarl.core.Logging
import java.util.UUID
import io.sarl.core.OpenEventSpace
import be.uclouvain.organisation.OrganisationInfo
import io.sarl.core.Behaviors
import io.sarl.lang.core.AgentContext
import io.sarl.core.DefaultContextInteractions
import java.util.concurrent.atomic.AtomicInteger

/** 
 * 
 * @author $Author: manjahdani$
 * @version $0.1$
 * @date $31/03/2021$
 * @mavengroupid $be.uclouvain.aptitude$
 * @mavenartifactid $organisation$
 */
 
behavior ObserverRole {
	
	uses Logging, Behaviors, DefaultContextInteractions

	protected var TOLDSpace : OpenEventSpace
	protected var TOLDID : UUID
	protected var PlatformContext : AgentContext

	protected var observerID : UUID
	protected var sensitivity = new AtomicInteger()
	
	@SuppressWarnings("potential_field_synchronization_problem")
	on Initialize {
		observerID = occurrence.parameters.get(1) as UUID
	}

	on Destroy {
		info("The behavior was stopped.")
	}

	@SuppressWarnings("potential_field_synchronization_problem")
	on OrganisationInfo {
		//info("Joining the Platform organisation: " + occurrence.spaceID + " (" + occurrence.context + ").")
		PlatformContext = occurrence.context
		TOLDID = occurrence.source.getUUID
		TOLDSpace = occurrence.spaceID
		TOLDSpace.register(asEventListener)
		emit(new SensititvityRequest)[it.UUID==observerID]
	}

	on SensititvityRequest {
		info("Thank you for joining the mission. Please use the following sensitivity" + sensitivity.get)
		//info("I received A Sensititivy Request" + occurrence.source.UUID)
		emit(new MissionSensitivity(sensitivity.get)
		)[it.UUID == occurrence.source.UUID]
	}
	
	
	//	on LeavePlatform {
//		// join(BaseContext.ID, BaseSpace.spaceID.ID)
//		info("ObserverLeaving")
//		leave(PlatformID)
//	}
}
